# Nexus of Mind - Docker Compose
# Production deployment configuration

services:
  # Python AI Backend Service
  ai-backend:
    build:
      context: .
      dockerfile: server/Dockerfile
    container_name: nexus-ai-backend
    ports:
      - "8010:8010"
    environment:
      - ENVIRONMENT=production
      - HOST=0.0.0.0
      - PORT=8010
      - LOG_LEVEL=info
      - CORS_ORIGINS=${CORS_ORIGINS:-http://localhost:3010}
    volumes:
      - ./logs:/app/logs
    networks:
      - nom-network
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8010/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 60s

  # Game Client (Static files served via 'serve')
  game-client:
    build:
      context: .
      dockerfile: client/Dockerfile
    container_name: nexus-game-client
    ports:
      - "3010:3010"
    networks:
      - nom-network
    depends_on:
      ai-backend:
        condition: service_healthy
    restart: unless-stopped

networks:
  nom-network:
    driver: bridge
